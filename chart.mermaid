graph TD
    subgraph Core[Vinyl Core System]
        V[Vinyl Node]
        PM[Plugin Manager]
        CTX[Plugin Context]
        LIB[libp2p]
        HEL[Helia/IPFS]
        
        V -->|manages| PM
        V -->|provides| CTX
        CTX -->|access to| LIB
        CTX -->|access to| HEL
        PM -->|manages| PLUG[Plugins]
    end
    
    subgraph Protocol[Protocol Handling]
        LIB -->|registers| PROTO[Protocol Handlers]
        PLUG -->|provides| PROTOCOL_LIST[Protocol List]
        PROTOCOL_LIST -->|/vinyl/1.0.0\n/vinyl/metadata/1.0.0| PROTO
        PROTO -->|routes to| PLUG
    end
    
    subgraph Plugin[Plugin System]
        PLUG -->|implements| INTERFACE[Plugin Interface]
        INTERFACE --> CAP[getCapabilities]
        INTERFACE --> INIT[initialize]
        INTERFACE --> START[start]
        INTERFACE --> STOP[stop]
        INTERFACE --> HANDLE[handleProtocol]
        INTERFACE --> EVENTS[onPeerConnected\nonFileUploaded\n...]
        
        PLUG -->|can implement| HTTP[HTTP Interface]
        HTTP --> NAMESPACE[getHttpNamespace]
        HTTP --> ROUTER[getHttpRouter]
    end
    
    subgraph Lifecycle[Plugin Lifecycle]
        REG[Register Plugin] -->|1. initialize| INIT
        INIT -->|2. register protocols| PROTO
        INIT -->|3. add to registry| PM
        START_ALL[Start All] -->|plugin.start| PLUG
        STOP_ALL[Stop All] -->|plugin.stop| PLUG
    end
    
    subgraph Events[Event Propagation]
        V -->|triggers| PEER_EV[Peer Connected/Disconnected]
        V -->|triggers| FILE_EV[File Uploaded/Downloaded]
        PEER_EV -->|notifyPlugins| PM
        FILE_EV -->|notifyPlugins| PM
        PM -->|dispatches to| PLUG
    end
    
    subgraph Features[Plugin Features]
        PLUG --> METADATA[enhanceMetadata]
        PLUG --> SEARCH[searchFiles]
        PLUG --> REC[getRecommendations]
        PLUG --> PROTO_HANDLER[Protocol Handling]
    end
    
    Core -->|uses| Protocol
    Core -->|manages| Plugin
    Plugin -->|hooks into| Events
    Plugin -->|provides| Features